// Marionette.GroupedCollectionView
// --------------------
// v0.1.0
// 
// Copyright (c) 2014 Mattias Rydengren <mattias.rydengren@coderesque.com>
// Distributed under MIT license


Marionette.GroupedCollectionView=function(a,b,c){return a.CollectionView.extend({initialize:function(){var a=this.collection;this.listenTo(a,"add",this._add),this.listenTo(a,"remove",this._remove),this.listenTo(a,"reset",this._reset),this.groupByKey=this._getGroupByKey();var c=this._groupByKey(a);this.collection=new b.Collection(c)},buildItemView:function(a,b,d){var e=c.extend({model:a,collection:a.entries},d);return new b(e)},_add:function(a){var b=this._findGroupByModel(a);b?b.entries.add(a):(b=this._createGroupModel([a],a.get(this.groupByKey)),this.collection.add(b))},_remove:function(a){var b=this._findGroupByModel(a);b.entries.remove(a),0===b.entries.length&&this.collection.remove(b)},_reset:function(a){var b=this._groupByKey(a);this.collection.reset(b)},_createGroupModel:function(a,c){var d=new b.Model;d.set(this.groupByKey,c),d.entries=new b.Collection(a);var e=this._pickAdditionalValues(d);return d.set(e),d},_getGroupByKey:function(){var b=a.getOption(this,"groupByKey");if(!b)throw new Error("A `groupByKey` must be specified");return b},_groupByKey:function(a){var b=this.groupByKey,d=a.groupBy(b);return c.map(d,this._createGroupModel,this)},_findGroupByModel:function(a){var b=this.groupByKey;return this.collection.find(function(c){return c.get(b)===a.get(b)})},_pickAdditionalValues:function(b){var d=a.getOption(this,"additionalKeys"),e=c.isArray(d)?d:[];if(0===e.length)return{};var f=b.entries.at(0),g=f.toJSON(),h=[g];return h.push.apply(h,e.slice(0)),c.extend({},c.pick.apply(null,h))}})}(Marionette,Backbone,_);
//# sourceMappingURL=marionette.groupedcollectionview.min.map